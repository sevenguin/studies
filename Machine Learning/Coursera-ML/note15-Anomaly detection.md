## Anomaly detection

异常检测是机器学习算法的一个常见应用，例如飞机引擎制造商，采集引擎的各个特征（发热、声音等），得到一个数据集，然后预测新的引擎$x^{(test)}$是否有异常。

正式的定义：

给定数据集$\{x^{(1)},x^{(2)},..,x^{(m)}\}$（都标注好是正常还是异常的），然后训练模型P(x)，预测新的引擎$x_{test}$是否正常，一般会以下面的方式给出结果：
$$
P(x_{test})\lt \epsilon 是异常的或者P(x_{test})\ge\epsilon是正常的
$$
异常检测一般有以下应用案例：

* __Fraud detection(欺诈检测):__数据是用户的行为数据（例如网站用户的访问页面、停留时间、打字速度），构建模型$p(x)$，然后标注$p(x)\lt \epsilon$的用户为异常用户（不寻常用户）。
* __Manufacturing(工程领域):__例如检查引擎是否正常
* __监控集群或数据中心__

###  高斯分布

参数估计：

假设有数据集$x^{(1)},x^{(2)}, …, x^{(m)}$，如果x服从高斯分布，估计参数$\mu, \sigma$，则：
$$
\mu={1\over m}\sum_{i=1}^mx^{(i)}，\sigma^2={1\over m}\sum_{i=1}^m(x^{(i)}-\mu)^2
$$
其实就是计算数据集的均值和方差。

#### 异常检测算法

使用高斯分布进行异常检测，一下步骤：

1. 选择特征$x_i$：这个特征可以在某些方面标识出哪些事异常样本

2. 获取数据集：$x^{(1)},x^{(2)},…,x^{(m)}$

3. 训练参数：$\mu_1, \mu_2,…\mu_n,\sigma_1^2, \sigma_2^2,…\sigma_n^2$，就是求均值和标准差

4. 对新的样本x计算$p(x)$：
   $$
   p(x) = \prod_{j=1}^np(x_j;\mu_j,\sigma_j^2)=\prod_{j=1}^n{1\over \sqrt{2\pi}\sigma_j}\exp(-{(x_j-\mu_j)^2\over2\sigma_j^2})
   $$
   这个使用的前提是，所有特征均服从高斯分布，并且独立，即：独立同分布。所以才有：

$$
p(x) = \prod_{j=1}^np(x_j;\mu_j,\sigma_j^2)，即模型概率等于各个特征的概率之积
$$

5. 异常数据即：$p(x)<\epsilon$

### 开发和评估一个异常检测系统

假设有已经标签的数据集，然后取出一部分数据，用检测方法训练出模型，然后用余下的数据一部分作为验证集合测试集，用他们自带的标签和训练得到的标签的比较来评估预测方法。

算法评估步骤：

1. fit model on training set $\{x^{(1)},…,x^{(m)}\}$
2. on a cross validation/test example x, predict:
   1. 1 if $p(x)\lt \epsilon$（异常）
   2. 0 if $p(x)\ge\epsilon$（正常）
3. 使用评估值评估
   1. 精准率、召回率
   2. $F_1$ score


### 异常检测 vs. 监督学习

异常检测的数据倾斜很厉害——即正例（异常数据）数据比例很小而反例很大；而且异常检测的对象可能经常变（例如发动机新品），这样选择监督学习方法的话就会经常失效。

如果不满足上面两个特点，选择监督学习也是可行的。否则异常检测的方法更加有效。

### 特征选择

如何选择特征变量？

可以对各个特征数据绘图，看看是否符合高斯分布，如果不符合，则做一些变换（$\log(x)$符合高斯。因为符合高斯分布的特征算法效果更好。

如何得到异常检测算法的特征变量？

使用留一法来进行交叉验证个各个特征，然后选择对异常检测贡献较大的特征。

可以对现有特征进行计算、或者多个特征进行互相计算（如果他们之间有关系）从而使新的特征能够满足高斯分布。

### 多元高斯分布




